<script>
    let reservationdata = {};
    //get coordinates
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    }
    function showPosition(position) {   // If Access Granted Set GPS Position in Long/Lat.
        latitude = position.coords.latitude;
        longitude = position.coords.longitude;
        reservationdata.gps = latitude+','+longitude;
    }
</script>

<html>
<head>
    <title>Express</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
    <script
            src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"
            integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>
</head>
<body>
<h1>Restaurantreservierung</h1>
<div id="initalPage">
    <label for="number">Anzahl Personen:</label>
    <input type="number" name="name" id="number" value="">
    <br>
    <label for="time">Uhrzeit:</label>
    <input type="time" name="name" id="time" value="">
    <br>
    <label for="date">Datum:</label>
    <input type="date" name="name" id="date" value="">
    <br>
    <button id="reserveRestaurant">Jetzt reservieren</button>
</div>
<div id="afterReservation">
    <p id="gebucht">Ihr Restaurantbesuch wurde erfolgreich gebucht.</p>
    <p id="nichtGebucht">Tut mir Leid, aber leider ist kein Platz mehr frei.</p>
    <br>
    <button id="reserveCarpark">Jetzt nächstmögliches Parkhaus suchen</button>
</div>
<div id="searchCarparks">
    <p>Hier sehen Sie Ihre Route zum nächstmöglichen Parkhaus</p>
    <div id="nav"></div>
    <script type="text/javascript">
        document.getElementById('nav').innerHTML = '' + '<iframe target="_top" width="600" height="450" frameborder="0" style="border:0" src="https://www.google.com/maps/embed/v1/directions?key=AIzaSyBVgTiWDbf4snT64vZvGfEZ36qXWPewvko&origin='+reservationdata.gps+'&destination=Cologne+Germany" allowfullscreen></iframe>';
    </script>
</div>

<script>
    $(function () {//Socketio setup
        let latitude = 0;
        let longitude = 0;
        let socket = io('http://localhost:3030/');
        socket.on('message', function () {
        });
        $('#reserveCarpark').hide();
        $('#gebucht').hide();
        $('#nichtGebucht').hide();
        $('#afterReservation').hide();
        $('#searchCarparks').hide();
        //Hier wird das Reservierungsdaten Objekt angereichert und an den Dienstnutzer übergeben
        $('#reserveRestaurant').click(function (e) {
            e.preventDefault(); // prevents page reloading
            reservationdata.anzahl_personen = $('#number').val();
            reservationdata.uhrzeit = $('#time').val();
            reservationdata.datum = $('#date').val();
            socket.emit('reservationdata', reservationdata);
            $('#initalPage').hide();
            socket.on('response', function (response) {
                if (response.statusCode == 200) {
                    $('#afterReservation').show();
                    $('#gebucht').show();
                    $('#reserveCarpark').show();
                } else {
                    $('#afterReservation').show();
                    $('#nichtGebucht').show();
                }
            })
        });
        //Hier werden die Reservierungsdaten an den Dienstnutzer übergeben um anschließend eine Parkhaussuche zu starten
        $('#reserveCarpark').click(function (e) {
            console.log("Button Carpark Test");
            e.preventDefault(); // prevents page reloading
            socket.emit('position', reservationdata);
            //Hier wird die Position eingebunden?
            $('#gebucht').hide();
            $('#reserveCarpark').hide();
            $('#searchCarparks').show();
        });
    });
</script>
</body>
</html>
